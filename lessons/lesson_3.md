# Занятие 3

## Теоретическая часть

#### Система модулей в nodejs
 - commonjs  
   - exports.func = () => 1;  
   - module.exports = () => 1;  
 - esm-модули  
   - import  
   - export  
   - export default  
 - использование флага --experimental-modules в node10  

### npm-модули
 - Установка модулей через npm  
   - node_modules  
   - NODE_PATH и переменные окружения  
 - Пример установки и подключения модуля commander  

### Стандартная библиотека модулей
 - общая информация о существующих в nodejs модулях  

### Общая информация об асинхронности в nodejs
 - event-loop  
 - коллбэки  
 - process.nextTick, setTimeout, setInterval, ...  
 - try-catch для асинхронных функций и обработка ошибок  
 - stream-ы  


## Практическая часть

### Задание 1
В файле task1.json лежит текст очень похожий на json, но это не json.
Предыдущий программист допустил ряд ошибок и нам нужно их исправить.
Вот эти ошибки:
 - в конце файла лишняя точка, ее нужно удалить  
 - формат birthday - timestamp, его тяжело читать визуально, нужно заменить на ISODate  
 - в файле содержится пароль пользователя, его там быть не должно  
Нужно прочитать файл в память, модифицировать и записать его обратно (или в другой файл)  

### Задание 2
В каталоге task_2 лежит набор файлов. Файлы имеют разные расширения.
Нужно написать программу, которая отфильтровывает список файлов 
в каталоге по заданному расширению и выводит их на экран.
Имя каждого файла должно быть на новой строке.  
(Смотреть стандартные модули fs и path)  
Пример запуска программы:  
```js
node main.js filter --dir {dirname} --ext {ext}
```
* также можно попробовать выполнить фильтрацию файлов средствами bash и child_process.exec

### Задание 3
Имеется файл с логами. В каждой строке файла лежит валидный JSON.
Необходимо написать программу, которая будет
читать этот файл через stream
и выводить на экран только строки удовлетворяющие условию:  
```js
name: "Validation Error"
```
(нужно исходить из того, что файл очень большой и в память может не поместиться)  
Подсказка: stream-ы  
Запуск программы должен осуществляться командой:  
```js
node main.js log-filter --filename {filename} --prop {value}
```
* Можно усовершенствовать программу, добавив возможность фильтрации
по вложенным глубоко свойствам

## Homework

### Задание 1
Написать синхронизатор директорий, который будет все файлы и
каталоги из src копировать в dest рекурсивно.  

### Задание 2
Написать функцию parallel, которая принимает на вход два параметра:
 - массив задач  
 - коллбэк об окончании  
Задача - асинхронная функция, которая принимает на вход коллбэк.
По завершении своей работы задача вызовет переданный ей коллбэк.
Пример использования функции parallel:
```js
const tasks = [cb => {/* некоторый асинхронный код */; cb();}, ...];
parallel(tasks, () => console.log('done'));
```
Подсказка: внутри функции parallel не должно быть таймеров и подобных вещей.